<div class="hero">
    <h1 class="hero-title">Укажите маршрут</h1>
    <p class="hero-subtitle">и дату поездки</p>
    <form asp-controller="Home" asp-action="FindSchedule" method="post">
        <div class="in date">
            <input class="dateIn" type="date" id="date" name="date" placeholder="Дата" value="@DateTime.Now.ToString("yyyy-MM-dd")">
        </div>
        <div class="in city">
            <div class="from">
                <select id="cityFrom" class="cityFromIn cityIn" name="cityFrom">
                    <option value=""></option>
                </select>
            </div>
            <img src="~/images/Arrow1.png" alt="" class="arrow">
            <div class="to">
                <select id="cityTo" class="cityToIn cityIn" name="cityTo">
                    <option value=""></option>
                </select>
            </div>
        </div>

        <li class="show-offers">
            <button type="submit" id="showOffersButton" class="disables">
                <img class="trainBut" src="~/images/train.png" alt="">Показать предложения
            </button>
        </li>
        <div class="trainImgs">
            <div class="trainRed-container">
                <img class="trainRed" src="~/images/trainRed.png" alt="">
                <div class="train-light left"></div> 
                <div class="train-light right"></div>
            </div>
            <img class="trainGray" src="~/images/trainGray.png" alt="">
        </div>
    </form>
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var dateInput = document.getElementById("date");
            var today = new Date();
            var day = String(today.getDate()).padStart(2, '0');
            var month = String(today.getMonth() + 1).padStart(2, '0');
            var year = today.getFullYear();
            dateInput.value = `${year}-${month}-${day}`;

            var stations = @Html.Raw(Json.Serialize(ViewBag.Stations));

            var cityFromSelect = document.getElementById("cityFrom");
            var cityToSelect = document.getElementById("cityTo");
            var showOffersButton = document.getElementById("showOffersButton");
            
            stations.forEach(function(station) {
                var optionFrom = document.createElement("option");
                optionFrom.value = station;
                optionFrom.text = station;
                cityFromSelect.appendChild(optionFrom);

                var optionTo = document.createElement("option");
                optionTo.value = station;
                optionTo.text = station;
                cityToSelect.appendChild(optionTo);
            });
            
            cityFromSelect.addEventListener("change", function() {
                var selectedFrom = cityFromSelect.value;
                disableOption(cityToSelect, selectedFrom);
                checkForm();
            });
            
            cityToSelect.addEventListener("change", function() {
                var selectedTo = cityToSelect.value;
                disableOption(cityFromSelect, selectedTo);
                checkForm();
            });
            
            function disableOption(selectElement, valueToDisable) {
                Array.from(selectElement.options).forEach(function(option) {
                    if (option.value === valueToDisable) {
                        option.disabled = true;
                    } else {
                        option.disabled = false;
                    }
                });
            }
            
            function checkForm() {
                var isFromFilled = cityFromSelect.value !== "";
                var isToFilled = cityToSelect.value !== "";

                if (isFromFilled && isToFilled) {
                    showOffersButton.classList.remove("disabled");
                } else {
                    showOffersButton.classList.add("disabled");
                }
            }
            
            checkForm();
        });
    </script>
}