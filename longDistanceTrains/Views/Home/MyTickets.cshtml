@model longDistanceTrains.Models.ViewModels.MyTicketsVM
<link rel="stylesheet" href="~/css/myTickets.css" asp-append-version="true"/>

<div class="hero">
    <h1>Ваши билеты</h1>
    <div class="tickets">
        @foreach (var detail in Model.TicketDetails)
        {
            var ticket = detail.Ticket;
            var route = detail.Route;
            var schedules = detail.Schedules;
            
            var ticketSchedule = schedules.FirstOrDefault(s => s.routFK == route.routeID);
            
            var timeDeparture = ticketSchedule?.timeDeparture.ToString("HH:mm") ?? "N/A";
            var timeArrival = ticketSchedule?.timeArrival.ToString("HH:mm") ?? "N/A";

            var stops = route.stops.Split(new[] { '/' }, StringSplitOptions.RemoveEmptyEntries);
            var departureStation = stops.FirstOrDefault()?.Trim() ?? "N/A";
            var arrivalStation = stops.LastOrDefault()?.Trim() ?? "N/A";
            var cities = route.title.Split(new[] { '/' }, StringSplitOptions.RemoveEmptyEntries);
            var departureCity = cities.FirstOrDefault()?.Trim() ?? "N/A";
            var arrivalCity = cities.LastOrDefault()?.Trim() ?? "N/A";

            var isTicketExpired = ticketSchedule?.timeDeparture < DateTime.Now;

            <div class="lines">
                <div class="string">
                    <div class="timeT">
                        <p class="timeDep">@timeDeparture</p>
                        <p class="timeAri">@timeArrival</p>
                    </div>
                    <img class="lineRoute" src="~/images/Line2.png" alt="">
                    <div class="stations">
                        <div class="stationDep">
                            <p class="st">@departureStation</p>
                            <p class="city">@departureCity</p>
                        </div>
                        <li class="route"><a href="">Маршрут</a></li>
                        <div class="stationAri">
                            <p class="st">@arrivalStation</p>
                            <p class="city">@arrivalCity</p>
                        </div>
                    </div>
                    <img class="optionsT" src="~/images/tualetka.png" alt="">
                </div>
                <hr class="hrT">
                @if (!isTicketExpired)
                {
                    <div class="knop">
                        <img id="qrCodeImage" src="~/images/qrCode.png" alt="QR Code" onclick="openFullscreenQR()">
                    </div>
                }
            </div>
        }
    </div>
</div>

<div id="fullscreenQRModal" class="modal">
    <span class="close" onclick="closeFullscreenQR()">&times;</span>
    <img class="modal-content" id="fullscreenQRImage" src="~/images/qrCode.png" alt="Fullscreen QR Code">
</div>

@section Scripts{
    <script>
        function openFullscreenQR() {
            const modal = document.getElementById('fullscreenQRModal');
            modal.style.display = 'block'; // Показываем модальное окно
        }

        function closeFullscreenQR() {
            const modal = document.getElementById('fullscreenQRModal');
            modal.style.display = 'none'; // Скрываем модальное окно
        }

        // Закрытие модального окна при клике вне изображения
        window.onclick = function(event) {
            const modal = document.getElementById('fullscreenQRModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        };
    </script>
}